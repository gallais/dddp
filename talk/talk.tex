\documentclass{beamer}
    \usepackage{agdagremlins}
    \mode<presentation>
    {
    \usetheme{Copenhagen}
    %usecolorscheme{}
    %or ...
    %useoutertheme[footline=pagenumber]{smoothbars}
%    \useinnertheme[shadow=true]{rounded}
    %\usecolortheme{seahorse}
    \usecolortheme{dolphin}
    \usefonttheme{structurebold}
%    \setbeamertemplate{footline}{\hskip2pt\insertpagenumber\vskip2pt}{}
%    \setbeamercovered{transparent=5}
    }
    \setbeamercolor{math text}{use={father},fg=father.fg!70!blue}
    \usepackage{xcolor}
    \usepackage{mathpartir}
    \usepackage{tikz}
    \usepackage{pgfplots}
    \usepackage{stmaryrd}
    \pgfplotsset{compat=newest}
    \usetikzlibrary{shapes.geometric,arrows,fit,matrix,positioning}
    \usetikzlibrary{decorations.pathreplacing,arrows.meta}
    \tikzset
    {
        treenode/.style = {circle, draw=black, align=center, fill=white, minimum size=1cm},
        treenodenew/.style = {circle, draw=black, align=center, fill=yellow, minimum size=1cm},
        subtree/.style  = {isosceles triangle, draw=black, align=center, minimum height=0.5cm, minimum width=1cm, shape border rotate=90, anchor=north}
    }
    \title{Deferring the Details and Deriving Programs}
    \author{Liam O'Connor}
    \institute{UNSW Sydney, Australia}
    \date{TyDe, August 2019}

    \begin{document}

    \maketitle
    \begin{frame}[fragile]{Dependently-typed Data Structures}
        Dependent types are great. They let us bake our data invariants into 
        our data structures:
\begin{code}
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{Nil}%
\>[9]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\>[4]\AgdaInductiveConstructor{Cons}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\<%
%
\end{code}
\pause 
 
\begin{code}
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{m}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\>[4]\AgdaInductiveConstructor{Branch}%
\>[12]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaBound{m}\AgdaSpace{}%
\AgdaBound{n}\<%
%
\end{code}
    \end{frame}
    \begin{frame}{Hoare Logic}
\vskip-1.5em
        $$\{ \varphi \}\ P\ \{ \psi \} \equiv P : [\ \varphi\ ,\ \psi\ ]$$
\vskip-1.5em
\begin{code}
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[\AgdaUnderscore{},\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Assertion}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Assertion}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set₁}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}\pause \\[-2.5em]
\begin{code}
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{SEQ}%
\>[10]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{α}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{α}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\end{code}\pause \\[-2.5em]
\begin{code}
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{CHO}%
\>[10]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\end{code}\pause \\[-2.5em]
\begin{code}
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{STAR}%
\>[10]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\end{code} \pause \\[-2.5em]
\begin{code}
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{GUARD}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Assertion}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\end{code} \pause \\[-2.5em]
\begin{code}
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaInductiveConstructor{UPD}%
\>[10]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{Σ:}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Σ:}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}%
\>[37]\AgdaOperator{\AgdaDatatype{]}}\<%
\end{code}\pause \\[-2.5em]
\begin{code}
\>[2]\AgdaFunction{CONS}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{Π:}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
\end{code}\pause \\[-2.5em]
\begin{code}
\>[2]\AgdaFunction{SKIP}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
\end{code}\pause 
\begin{flushright}
\vskip-8em
\begin{tikzpicture}
    \node[draw, fill=white, text width=3.2cm,align=center] at (0,0) {See paper for\\ \alert{relational semantics}\\ and\\ \alert{soundness proof}.};
\end{tikzpicture}
\end{flushright}
    \end{frame}
    \begin{frame}{Deterministic Constructs}
\begin{code}
\>[2]\AgdaFunction{IFTHENELSE}%
\>[994I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Assertion}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[994I]%
\>[13]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
%
\>[13]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}%
\>[30]\AgdaOperator{\AgdaDatatype{]}}\<%
\\
%
\>[13]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
\>[2]\AgdaFunction{IFTHENELSE}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{Q}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{CHO}%
\>[1021I]\AgdaSymbol{(}\AgdaInductiveConstructor{SEQ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{SEQ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{CONS}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{GUARD}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[1021I]%
\>[10]\AgdaSymbol{(}\AgdaInductiveConstructor{SEQ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{SEQ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{CONS}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{GUARD}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}\<%
\end{code}\pause
\begin{code}
\>[2]\AgdaFunction{WHILE}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{g}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Assertion}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaGeneralizable{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
%
\>[2]\AgdaFunction{WHILE}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{SEQ}%
\>[1011I]\AgdaSymbol{(}\AgdaInductiveConstructor{STAR}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{SEQ}%
\>[1013I]\AgdaSymbol{(}\AgdaInductiveConstructor{SEQ}%
\>[1014I]\AgdaSymbol{(}\AgdaFunction{CONS}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{flip}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}}}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[1014I]%
\>[34]\AgdaSymbol{(}\AgdaInductiveConstructor{GUARD}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[1013I]%
\>[29]\AgdaBound{P}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[1011I]%
\>[18]\AgdaSymbol{(}\AgdaInductiveConstructor{SEQ}%
\>[1018I]\AgdaSymbol{(}\AgdaFunction{CONS}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{flip}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}}}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[1018I]%
\>[23]\AgdaSymbol{(}\AgdaInductiveConstructor{GUARD}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)))}\<%
\end{code}
    \end{frame}
    \begin{frame}{Ugly}
        This technique is very powerful! \pause \textbf{\alert{but...}}
        \begin{code}
\>[2]\AgdaFunction{ls}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaNumber{5}\<%
\\
%
\>[2]\AgdaFunction{ls}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[1042I]\AgdaInductiveConstructor{Cons}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)}\<%
\\
\>[1042I][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{(}\AgdaInductiveConstructor{Cons}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)}\<%
\\
\>[8][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaSymbol{(}\AgdaInductiveConstructor{Cons}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{))}\<%
\\
\>[10][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaSymbol{(}\AgdaInductiveConstructor{Cons}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)))}\<%
\\
\>[12][@{}l@{\AgdaIndent{0}}]%
\>[14]\AgdaSymbol{(}\AgdaInductiveConstructor{Cons}\AgdaSpace{}%
\AgdaNumber{5}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{))))}\<%
\\
\>[14][@{}l@{\AgdaIndent{0}}]%
\>[16]\AgdaSymbol{(}\AgdaInductiveConstructor{Nil}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{))))))))))}\<%
\\
%
        \end{code}
    \end{frame}
    \begin{frame}{Uglier}
\hspace*{-4em}
\begin{tikzpicture}
    \node[text width=10cm] at (0,0) {
\begin{code}
\>[2]\AgdaFunction{ex}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaNumber{10}\<%
\\
%
\>[2]\AgdaFunction{ex}%
\>[924I]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Branch}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Branch}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)))}\AgdaSpace{}%
\\
\>[924I][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)))}\AgdaSymbol{)}\<%
\\
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{Branch}\AgdaSpace{}%
\AgdaNumber{5}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Branch}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{))))}%
\\
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{))))))}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{Branch}\AgdaSpace{}%
\AgdaNumber{10}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{))))))}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)))))))))))))}\<%
\\
        \end{code}
    };
    \end{tikzpicture}
    \end{frame}
    \begin{frame}{Ugliest}
\hspace*{-4.8em}
\begin{tikzpicture}
    \node[text width=10cm] at (0,0) {
        \begin{code}
\>[2]\AgdaFunction{p}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaRecord{⊤}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaField{r}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{sum}\AgdaSpace{}%
\AgdaField{a}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
%
\>[2]\AgdaFunction{p}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[2399I]\AgdaInductiveConstructor{SEQ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{UPD}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{r}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)\}))}\<%
\\
\>[2399I][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaSymbol{(}\AgdaInductiveConstructor{SEQ}%
\>[2425I]\AgdaSymbol{(}\AgdaFunction{WHILE}%
\>[25]\AgdaSymbol{\{}\AgdaField{r}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{sum}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{take}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaField{a}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaField{a}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaField{a}\AgdaSymbol{)}\<%
\\
\>[2425I][@{}l@{\AgdaIndent{0}}]%
\>[19]\AgdaSymbol{(}\AgdaInductiveConstructor{UPD}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{r≡sumᵢ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{i≤n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[19][@{}l@{\AgdaIndent{0}}]%
\>[21]\AgdaSymbol{(}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{r}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{r}\AgdaSpace{}%
\AgdaSymbol{⦃}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{⦄}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{a}\AgdaSpace{}%
\AgdaSymbol{⦃}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{⦄}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{!}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{i}\AgdaSpace{}%
\AgdaSymbol{⦃}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{⦄)}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\\
%
\>[21]\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaPrimitive{\AgdaUnderscore{}+}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaBound{r≡sumᵢ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{take-i-plus-next}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\}))}\<%
\\
%
\>[19]\AgdaSymbol{(}\AgdaFunction{CONS}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{¬i<len}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{r≡sumᵢ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{i≤len}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\<%
\\
\>[19][@{}l@{\AgdaIndent{0}}]%
\>[21]\AgdaFunction{trans}\AgdaSpace{}%
\AgdaBound{r≡sumᵢ}%
\>[2496I]\AgdaSymbol{(}\AgdaFunction{trans}%
\>[2497I]\AgdaSymbol{(}\AgdaFunction{cong}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{sum}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{take}\AgdaSpace{}%
\AgdaBound{h}\AgdaSpace{}%
\AgdaField{a}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[2497I]%
\>[41]\AgdaSymbol{(}\AgdaFunction{not-<-but-≤}\AgdaSpace{}%
\AgdaBound{¬i<len}\AgdaSpace{}%
\AgdaBound{i≤len}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[2496I]%
\>[34]\AgdaSymbol{(}\AgdaFunction{cong}\AgdaSpace{}%
\AgdaFunction{sum}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{take-length}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ℓ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{a}\AgdaSymbol{\})))}\AgdaSpace{}%
\AgdaSymbol{\}))}\<%
\\
%
        \end{code}
    };
    \end{tikzpicture}
    \end{frame}
    \begin{frame}{Our Ideal}
\begin{displaymath}
    \begin{array}{l}
        \alert{\{ \top \}}\\
        i := 0\\
        r := 0\\
        \alert{\{ r = \Sigma_{k=0}^i a[k] \land i \leq \mathsf{length}\ a\}} \\
        \textbf{\textsf{while}}\ i < \textsf{length}\ a\ \textbf{\textsf{do}}\\
        \quad r := r + A[i]\\
        \quad i := i + 1\\
        \quad \alert{\{ r = \Sigma_{k=0}^i a[k] \land i \leq \mathsf{length}\ a\}} \\
        \textbf{\textsf{od}}\\ 
        \alert{\{ r = \Sigma_{k=0}^{\textsf{length}\ a} a[k] \}}
    \end{array}
\end{displaymath}\pause
Each assertion generates a proof obligation for \alert{\textbf{later}} proof.\pause
\begin{center}
    \textbf{Separate \alert{structure} from \alert{proof}!}
\end{center}
    \end{frame}
    \begin{frame}{The Proof Delay Applicative}
\begin{code}
\>[2]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaGeneralizable{ℓ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{Level.suc}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[5]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{Prf}\<%
\\
%
\>[5]\AgdaKeyword{field}\<%
\\
\>[5][@{}l@{\AgdaIndent{0}}]%
\>[7]\AgdaField{goals}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
%
\>[7]\AgdaField{prove}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{HList}\AgdaSpace{}%
\AgdaField{goals}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{X}\<%
\end{code}\pause \\[-2em]
\begin{code}
\>[2]\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaGeneralizable{X}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaGeneralizable{X}\<%
\\
%
\>[2]\AgdaFunction{pure}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Prf}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{const}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\end{code}\pause \\[-2em]
\begin{code}
\>[2]\AgdaFunction{later}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaBound{X}\<%
\\
%
\>[2]\AgdaFunction{later}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{X}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Prf}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{X}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}\pause \\[-2em]
\begin{code}
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}\ensuremath{\circledast}\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}%
\>[11]\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaGeneralizable{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaGeneralizable{B}\<%
\\
%
\>[2]\AgdaInductiveConstructor{Prf}\AgdaSpace{}%
\AgdaBound{goals₁}\AgdaSpace{}%
\AgdaBound{prove₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\ensuremath{\circledast}}}\AgdaSpace{}%
\AgdaInductiveConstructor{Prf}\AgdaSpace{}%
\AgdaBound{goals₂}\AgdaSpace{}%
\AgdaBound{prove₂}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Prf}%
\>[138I]\AgdaSymbol{(}\AgdaBound{goals₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{++}}\AgdaSpace{}%
\AgdaBound{goals₂}%
\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[138I]%
\>[10]\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{hl}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{prove₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{takeH}\AgdaSpace{}%
\AgdaBound{hl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{prove₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{dropH}\AgdaSpace{}%
\AgdaBound{hl}\AgdaSymbol{))}\<%
\end{code}
    \end{frame}
    \begin{frame}{Deferring the Details}
\begin{code}
\>[2]\AgdaFunction{nil}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaGeneralizable{m}\AgdaSpace{}%
\AgdaGeneralizable{n}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{nil}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{⦇}\AgdaSpace{}%
\AgdaInductiveConstructor{Nil}\AgdaSpace{}%
\AgdaFunction{later}\AgdaSpace{}%
\AgdaSymbol{⦈}\<%
%
\end{code}
\begin{code}
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}cons\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaGeneralizable{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaGeneralizable{m}\AgdaSpace{}%
\AgdaGeneralizable{n}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{cons}}\AgdaSpace{}%
\AgdaBound{xs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{⦇}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Cons}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{later}\AgdaSpace{}%
\AgdaBound{xs}\AgdaSpace{}%
\AgdaSymbol{⦈}\<%
\end{code}\pause\\[-2em]
\begin{code}
\>[2]\AgdaFunction{example}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{OList}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaNumber{5}\<%
\\
%
\>[2]\AgdaFunction{example}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[984I]\AgdaOperator{\AgdaFunction{structure:}}\AgdaSpace{}%
\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{cons}}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{cons}}\AgdaSpace{}%
\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{cons}}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{cons}}\AgdaSpace{}%
\AgdaNumber{5}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{cons}}\AgdaSpace{}%
\AgdaFunction{nil}\<%
\\
\>[.][@{}l@{}]\<[984I]%
\>[13]\AgdaOperator{\AgdaFunction{proofs:}}\<%
\\
\>[13][@{}l@{\AgdaIndent{0}}]%
\>[15]\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
%
\>[13]\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\<%
\\
%
\>[13]\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)}\<%
\\
%
\>[13]\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{))}\<%
\\
%
\>[13]\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{)))}\<%
\\
%
\>[13]\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaInductiveConstructor{z≤n}\AgdaSymbol{))))}\<%
\\
%
\>[13]\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[13]\AgdaOperator{\AgdaFunction{done}}\<%
%
\end{code}
    \end{frame}
    \begin{frame}{Deferring for Trees}
\begin{code}
\>[2]\AgdaFunction{leaf}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaGeneralizable{m}\AgdaSpace{}%
\AgdaGeneralizable{n}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{leaf}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{⦇}\AgdaSpace{}%
\AgdaInductiveConstructor{Leaf}\AgdaSpace{}%
\AgdaFunction{later}\AgdaSpace{}%
\AgdaSymbol{⦈}\<%
\\
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaFunction{branch}%
\>[800I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaGeneralizable{m}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaGeneralizable{n}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[800I]%
\>[9]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaGeneralizable{m}\AgdaSpace{}%
\AgdaGeneralizable{n}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{branch}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{⦇}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{Branch}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{l}\AgdaSpace{}%
\AgdaBound{r}\AgdaSpace{}%
\AgdaSymbol{⦈}\<%
%
\end{code}
\begin{code}
\>[2]\AgdaFunction{example₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{BST}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaNumber{10}\<%
\\
%
\>[2]\AgdaFunction{example₂}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[861I]\AgdaOperator{\AgdaFunction{structure:}}%
\>[862I]\AgdaFunction{branch}\AgdaSpace{}%
\AgdaNumber{3}\<%
\\
\>[862I][@{}l@{\AgdaIndent{0}}]%
\>[25]\AgdaSymbol{(}\AgdaFunction{branch}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaFunction{leaf}\AgdaSpace{}%
\AgdaFunction{leaf}\AgdaSymbol{)}\<%
\\
%
\>[25]\AgdaSymbol{(}\AgdaFunction{branch}\AgdaSpace{}%
\AgdaNumber{5}\<%
\\
\>[25][@{}l@{\AgdaIndent{0}}]%
\>[28]\AgdaSymbol{(}\AgdaFunction{branch}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaFunction{leaf}\AgdaSpace{}%
\AgdaFunction{leaf}\AgdaSymbol{)}\<%
\\
%
\>[28]\AgdaSymbol{(}\AgdaFunction{branch}\AgdaSpace{}%
\AgdaNumber{10}\AgdaSpace{}%
\AgdaFunction{leaf}\AgdaSpace{}%
\AgdaFunction{leaf}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[861I]%
\>[13]\AgdaOperator{\AgdaFunction{proofs:}} \ensuremath{\langle \textit{omitted for brevity} \rangle}\<%
\\
%
\>[13]\AgdaOperator{\AgdaFunction{done}}\<%
\end{code}
    \end{frame}
 %   \begin{frame}{Aside: Proof Delay Monad?}
 %   \end{frame}
    \begin{frame}{\textrm{\textsc{Trip}}}
\begin{code}
\>[2]\AgdaFunction{assert}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ϕ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Assertion}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Delay}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaBound{ϕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaGeneralizable{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
%
\>[2]\AgdaFunction{assert}\AgdaSpace{}%
\AgdaBound{ϕ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{⦇}\AgdaSpace{}%
\AgdaFunction{CONS}\AgdaSpace{}%
\AgdaFunction{later}\AgdaSpace{}%
\AgdaSymbol{⦈}\<%
\end{code}

\begin{code}
\>[2]\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{⦇}\AgdaSpace{}%
\AgdaInductiveConstructor{SEQ}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaSymbol{⦈}\<%
\end{code}
\begin{code}
\>[2]\AgdaOperator{\AgdaFunction{if}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{then}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{else}}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{fi}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{⦇}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{IFTHENELSE}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaBound{q}\AgdaSpace{}%
\AgdaSymbol{⦈}\<%
\end{code}
\begin{code}
\>[2]\AgdaOperator{\AgdaFunction{while}}\AgdaSpace{}%
\AgdaBound{g}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{begin}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{end}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{⦇}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{WHILE}\AgdaSpace{}%
\AgdaBound{g}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{⦈}\<%
\end{code}
\begin{code}
\>[2]\AgdaFunction{upd}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{pure}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{UPD}\AgdaSpace{}%
\AgdaBound{u}\AgdaSymbol{)}\<%
\end{code}
    \end{frame}
    \begin{frame}{Swap and Assignment Macros}
\begin{tikzpicture}
\node[text width=7cm] at (0,0) {
\begin{code}
\>[2]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{SwapState}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaKeyword{field}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaField{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
%
\>[6]\AgdaField{j}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
%
\>[6]\AgdaField{temp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\end{code}
};\pause
\node[text width=7cm] at (0,-2) {
\begin{code}
\>[2]\AgdaFunction{swp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaBound{J}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaField{j}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{J}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaField{j}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{J}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\end{code}
};
\pause
%\node at (0.6,-0.6) {
%    \includegraphics[width=3cm]{phantom.png}
%};
%\pause
\node[text width=7cm] at (0,-4) {
\begin{code}
\>[2]\AgdaFunction{swp}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[1956I]\AgdaOperator{\AgdaFunction{structure:}}\<%
\\
\>[13]\AgdaFunction{upd}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{σ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{temp}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{i}%
\>[58]\AgdaSymbol{⦃}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{⦄}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[13]\AgdaFunction{upd}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{σ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{i}%
\>[51]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{j}%
\>[58]\AgdaSymbol{⦃}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{⦄}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[13]\AgdaFunction{upd}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{σ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{j}%
\>[51]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{temp}\AgdaSpace{}%
\AgdaSymbol{⦃}\AgdaSpace{}%
\AgdaBound{σ}\AgdaSpace{}%
\AgdaSymbol{⦄}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{p}\AgdaSpace{}%
\AgdaSymbol{\})}\<%
\\
\>[.][@{}l@{}]\<[1956I]%
\>[13]\AgdaOperator{\AgdaFunction{proofs:}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[13]\AgdaOperator{\AgdaFunction{done}}\<%
\end{code}
};\pause
\node[text width=4.5cm, align=center, fill=white,draw] at (4.3,0) {\Large $\{ \varphi [{}^e/_x] \}\ x := e\ \{ \varphi \}$};\pause
\node[text width=10cm, fill=white,draw] at (2.5,-3.65) {
\begin{code}
\>[2]\AgdaFunction{swp$'$}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀\{}\AgdaBound{I}\AgdaSpace{}%
\AgdaBound{J}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaField{j}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{J}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaField{j}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{I}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{J}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
%
\>[2]\AgdaFunction{swp$'$}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[2090I]\AgdaOperator{\AgdaFunction{structure:}}\<%
\\
\>[2090I][@{}l@{\AgdaIndent{0}}]%
\>[16]\AgdaField{temp}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaField{j}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\AgdaSpace{}%
\AgdaField{j}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaField{temp}\<%
\\
\>[.][@{}l@{}]\<[2090I]%
\>[12]\AgdaOperator{\AgdaFunction{proofs:}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[12]\AgdaOperator{\AgdaFunction{done}}\<%
\end{code}
};
\end{tikzpicture}
    \end{frame}

    \begin{frame}{Sum and Guarded Assignment}
\begin{tikzpicture}
\node[text width=10cm] at (0,0) {
\begin{code}
\>[2]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{SumState}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaKeyword{field}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaField{i}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
%
\>[6]\AgdaField{arr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\\
%
\>[6]\AgdaField{total}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\<%
\end{code}
};\pause
\node[text width=10cm] at (0,-3.5) { 
$\quad$\alert{Ideally, we would write:}\\[-1em]
\begin{code}
\>[.][@{}l@{}]\<[2226I]%
\>[9]\AgdaField{i}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[9]\AgdaField{total}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[9]\AgdaOperator{\AgdaFunction{while}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaField{arr}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[9][@{}l@{\AgdaIndent{0}}]%
%
\>[11]\AgdaField{total}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{total}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaField{arr}\AgdaSpace{}%
\AgdaOperator{\AgdaPostulate{!!}}\AgdaSpace{}%
\AgdaField{i}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[11]\AgdaField{i}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaField{i}\AgdaSymbol{)}\<%
\\
%
\>[9]\AgdaOperator{\AgdaFunction{end}}\AgdaSpace{}%
\end{code}
};\pause 
\node[text width=4.5cm,draw,thick] (foo) at (3,-2) {
\AgdaOperator{\AgdaPostulate{\AgdaUnderscore{}!!\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaGeneralizable{A}
};
\draw[ultra thick,->] (foo.south) -- (-0.1,-3.8);
\pause
\node[text width=10cm, fill=white,draw] at (0,0) {
\begin{code}
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}!\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%:
\AgdaSymbol{\{}\AgdaBound{n}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ls}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaGeneralizable{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaBound{ls}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaGeneralizable{A}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}!\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ls}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ls}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{!}}\AgdaSpace{}%
\AgdaBound{n}\<%
\\
%
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}!\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{ls}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{s≤s}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\<%
\end{code}
};
\node[text width=10cm,fill=white,draw] at (0,-3.8) {
\AgdaField{total}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaField{total}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{arr}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{!}}\AgdaSpace{}%
\AgdaBound{i<len}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaMacro{given}\AgdaSpace{}%
\AgdaBound{i<len}\AgdaSpace{}%
\AgdaMacro{∶}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaField{arr}\AgdaSymbol{)}\AgdaSpace{}%
};
\end{tikzpicture}
    \end{frame}
    \begin{frame}{Sum}
\begin{code}
\>[2]\AgdaFunction{lsum}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{[}}\AgdaSpace{}%
\AgdaRecord{⊤}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{,}}\AgdaSpace{}%
\AgdaField{result}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{sum}\AgdaSpace{}%
\AgdaField{arr}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{]}}\<%
\\
%
\>[2]\AgdaFunction{lsum}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\end{code}\\[-0.9em]
\begin{code}
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[7]\AgdaOperator{\AgdaFunction{structure:}}\<%
\\
\>[7][@{}l@{\AgdaIndent{0}}]%
\>[9]\AgdaFunction{assert}\AgdaSpace{}%
\AgdaRecord{⊤}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[9]\AgdaField{i}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[9]\AgdaField{total}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[9]\AgdaFunction{assert}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaField{total}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaNumber{0}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[9]\AgdaOperator{\AgdaFunction{while}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaField{arr}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[9][@{}l@{\AgdaIndent{0}}]%
\>[11]\AgdaField{total}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaField{total}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{arr}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{!}}\AgdaSpace{}%
\AgdaBound{i<len}\AgdaSymbol{)}\<%
\\
\>[11]$\quad$\AgdaMacro{given}\AgdaSpace{}%
\AgdaBound{i<len}\AgdaSpace{}%
\AgdaMacro{∶}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaField{arr}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[11]\AgdaField{i}\AgdaSpace{}%
\AgdaMacro{≔}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaPrimitive{+}}\AgdaSpace{}%
\AgdaField{i}\AgdaSymbol{)}\<%
\\
%
\>[9]\AgdaOperator{\AgdaFunction{end}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{﹕}}\<%
\\
%
\>[9]\AgdaFunction{assert}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{<}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaField{arr}\<%
\\
\>[11]$\quad$\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaField{total}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{sum}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{take}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaField{arr}\AgdaSymbol{)}\AgdaSpace{}\<%
\\
\>[11]$\quad$\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaField{i}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≤}}\AgdaSpace{}%
\AgdaFunction{length}\AgdaSpace{}%
\AgdaField{arr}\AgdaSpace{}%
\AgdaSymbol{)}\<%
\end{code}
    \end{frame}
    \begin{frame}{In the paper...}
        \begin{itemize}
            \item A proof delay \alert{monad} that requires replicating structure in the proofs.\pause
            \item Semantics and proofs about \textsc{Trip}.
            \item A lot of implementation details about the macros.\pause
            \item A more involved example (cumulative sum).\pause
            \item Comparisons to ornaments, Coq's \texttt{Program}, Morgan's refinement calculus, Schirmer's \textsc{SIMPL} and more!
        \end{itemize}\pause
        \structure{Future work:}
        \begin{itemize}
            \item A language importer.
            \item Integrating proof automation.
            \item State management, recursion, procedures.
            \item Other uses for the proof delay idea?
        \end{itemize}
    \end{frame}
    \begin{frame}{Thank you!}
        All the code, examples and proofs can be found here!

        $$\text{\Large \texttt{http://www.github.com/liamoc/dddp}}$$
    \end{frame}
\end{document}